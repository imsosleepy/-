# 2장. 카프카 설치하기
이번 장은 설치에 대한 내용이 많아서, 설정 옵션에 집중하기보다는 책을 읽다가 내가 잘몰랐던 부분에 대해서 정리하는 시간을 가졌음.


## 아파치 주키퍼(ZooKeeper)
> 주키퍼는 Kafka와 같은 분산 시스템에서 분산 코디네이션을 담당. 
> 분산 시스템에서 여러 노드나 컴포넌트가 서로 협력하여 일관된 작업을 수행하도록 돕는 역할. 
> 단일 컴퓨터 시스템에서는 프로세스와 자원이 한곳에 모여 있으므로 조정이 상대적으로 쉽지만, 분산 환경에서는 시스템이 서로 떨어져 있고 독립적으로 작동하므로 복잡한 조정이 필요하기 때문

- 분산 코디네이터의 역할이 k8s의 컨트롤플레인의 역할과 비슷하다고 생각함. 
- k8s의 컨트롤플레인은 사용자가 명시한 상태를 유지시키는 역할을 담당하기 때문. 
- 노드, 파드의 상태를 지속적으로 모니터링하여, 명시된 상태를 유지하기 위해 자동으로 조정하는 역할을 한다
- 그러나 최적화와 어떤 오픈소스를 추가 사용할지에 대한 고민이 많아서 여러 벤더에서 매니지드 시스템들이 제공됨
## 주키퍼의 앙상블
> 앙상블은 클러스터(여러 서버의 그룹)로 구성됨. 
> 앙상블 내의 서버들은 서로 협력하여 클라이언트 요청을 처리하고, 데이터를 저장하며, 장애를 복구함

### 앙상블의 구성 요소
- 리더(Leader)
  - 앙상블에서 단 하나의 서버가 리더 역할. 
  - 리더는 쓰기 요청을 처리하고, 다른 서버(팔로워)와 데이터 일관성을 유지. 
  - 클라이언트의 쓰기 요청은 반드시 리더를 통해 처리.

- 팔로워(Follower)
  - 리더 외의 모든 서버는 팔로워로 동작. 
  - 팔로워는 리더로부터 데이터를 복제하고 읽기 요청을 처리. 
  - 팔로워는 리더가 장애를 겪을 경우 새로운 리더를 선출하는 과정에 참여.

- 관찰자(Observer) (선택적)
  - 읽기 요청을 처리하지만, 리더 선출에는 참여하지 않음. 
  - 데이터 복제본을 유지하며, 쓰기 작업에는 관여하지 않으므로 클러스터의 부하를 줄이는 데 사용.

### 앙상블 크기
- 앙상블 크기는 일반적으로 홀수로 설정(예: 3, 5, 7). 
  - 홀수로 구성해 다수결을 통한 장애 복구. 
  - 최소 3개의 서버가 필요하며, 5개 이상의 서버는 고가용성 요구 사항에서 사용.

- 다수결(Quorum)
  - ZooKeeper는 요청을 처리하기 위해 앙상블의 과반수 이상(Quorum)이 동의해야 합니다. 
  - 예시
    - 3개의 서버 앙상블: 최소 2개의 서버가 응답하면 정상 작동. 
    - 5개의 서버 앙상블: 최소 3개의 서버가 응답해야 정상 작동. 
     - 이 규칙은 장애 복구와 데이터 일관성을 보장합니다.

### 분산 합의 알고리즘
...

## 
## 하드웨어 선택하기
카프카 자체는 하드웨어 구성을 요구하지 않아서, 적절한 하드웨어를 선택하는건 기예에 가깝다. 그래서 전체적인 성능에 영향을 미칠만한 요소들을 고려하는게 좋다.
ex) 디스크 처리량과 용량, 메모리, 네트워크, CPU

